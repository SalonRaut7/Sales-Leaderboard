<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sales Leaderboard Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,500,0,0"
    rel="stylesheet"
  />

  <style>
    :root{
      --bg: #0b1220;
      --panel: rgba(30, 41, 59, .65);
      --panel-2: rgba(15, 23, 42, .7);
      --border: rgba(148, 163, 184, .14);
      --text: #e5e7eb;
      --muted: rgba(226, 232, 240, .72);

      --primary: #3b82f6;
      --primary-2: #2563eb;

      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;

      --radius: 16px;
      --shadow: 0 18px 40px rgba(0,0,0,.35);
    }

    *{ box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(59,130,246,.25), transparent 55%),
        radial-gradient(900px 500px at 100% 0%, rgba(34,197,94,.16), transparent 50%),
        radial-gradient(1000px 600px at 30% 110%, rgba(245,158,11,.14), transparent 55%),
        var(--bg);
      padding: 28px;
    }

    .container{
      max-width: 1100px;
      margin: 0 auto;
    }

    header{
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 16px;
      margin-bottom: 18px;
    }

    .title{
      display: grid;
      gap: 6px;
    }

    h1{
      margin: 0;
      font-size: 28px;
      letter-spacing: -0.02em;
      line-height: 1.2;
    }

    .subtitle{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
    }

    .grid{
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
      margin: 18px 0 18px;
    }

    .card{
      grid-column: span 3;
      background: linear-gradient(180deg, rgba(30,41,59,.72), rgba(15,23,42,.58));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px 14px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      min-height: 88px;
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .icon{
      width: 40px; height: 40px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      border: 1px solid var(--border);
      background: rgba(2, 6, 23, .35);
      flex: 0 0 auto;
    }

    .material-symbols-rounded{
      font-variation-settings:
        "FILL" 0, "wght" 500, "GRAD" 0, "opsz" 24;
      font-size: 22px;
      color: #cbd5e1;
    }

    .kpi{
      display: grid;
      gap: 4px;
    }
    .kpi .label{
      font-size: 12px;
      color: var(--muted);
    }
    .kpi .value{
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .panel{
      background: linear-gradient(180deg, rgba(30,41,59,.68), rgba(15,23,42,.55));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      overflow: hidden;
    }

    .panel-header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      background: rgba(2, 6, 23, .25);
    }

    .panel-header h2{
      margin: 0;
      font-size: 14px;
      font-weight: 600;
      color: #e2e8f0;
      display: inline-flex;
      gap: 8px;
      align-items: center;
    }

    .panel-header .right{
      display: flex;
      gap: 10px;
      align-items: center;
      color: var(--muted);
      font-size: 12px;
    }

    form{
      padding: 14px 16px 16px;
      display: grid;
      grid-template-columns: 2fr 1.2fr .9fr auto;
      gap: 10px;
      align-items: end;
    }

    .field{
      display: grid;
      gap: 6px;
    }
    label{
      font-size: 12px;
      color: var(--muted);
    }

    input{
      width: 100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(2, 6, 23, .35);
      color: var(--text);
      outline: none;
      transition: border-color .15s ease, transform .05s ease;
    }
    input::placeholder{ color: rgba(226,232,240,.45); }
    input:focus{
      border-color: rgba(59,130,246,.55);
      box-shadow: 0 0 0 4px rgba(59,130,246,.12);
    }

    .btn{
      padding: 11px 14px;
      border-radius: 12px;
      border: 1px solid rgba(59,130,246,.35);
      background: linear-gradient(180deg, rgba(59,130,246,.95), rgba(37,99,235,.95));
      color: white;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      transition: transform .05s ease, filter .15s ease;
      white-space: nowrap;
    }
    .btn:hover{ filter: brightness(1.05); }
    .btn:active{ transform: translateY(1px); }
    .btn[disabled]{ opacity: .6; cursor: not-allowed; }

    .table-wrap{ overflow: auto; }

    table{
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }

    thead th{
      position: sticky;
      top: 0;
      z-index: 1;
      background: rgba(2, 6, 23, .55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      text-align: left;
      font-size: 12px;
      color: rgba(226,232,240,.8);
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
    }

    tbody td{
      padding: 12px 14px;
      border-bottom: 1px solid rgba(148,163,184,.10);
      color: rgba(226,232,240,.9);
      font-size: 13px;
      background: transparent; /* important so row highlight is clean */
    }

    tbody tr:hover{
      background: rgba(148, 163, 184, .06);
    }

    .col-rank{ width: 90px; }

    .rank{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
    }

    /* --------- Better Top 3 representation ---------
       Clearer colors + left accent bar + subtle glow
    */

    /* Row tint (clear, readable) */
    tbody tr.top1{ background: rgba(245, 158, 11, 0.18); }   /* Gold */
    tbody tr.top2{ background: rgba(203, 213, 225, 0.14); }  /* Silver */
    tbody tr.top3{ background: rgba(251, 146, 60, 0.15); }   /* Bronze */

    /* Hover: slightly stronger but consistent */
    tbody tr.top1:hover{ background: rgba(245, 158, 11, 0.24); }
    tbody tr.top2:hover{ background: rgba(203, 213, 225, 0.20); }
    tbody tr.top3:hover{ background: rgba(251, 146, 60, 0.21); }

    /* Strong left bar indicator */
    tbody tr.top1 td:first-child,
    tbody tr.top2 td:first-child,
    tbody tr.top3 td:first-child{
      position: relative;
      padding-left: 18px; /* room for the bar */
    }

    tbody tr.top1 td:first-child::before,
    tbody tr.top2 td:first-child::before,
    tbody tr.top3 td:first-child::before{
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 6px;
      border-radius: 0 10px 10px 0;
      opacity: 0.95;
    }
    tbody tr.top1 td:first-child::before{ background: #fbbf24; } /* Gold */
    tbody tr.top2 td:first-child::before{ background: #e2e8f0; } /* Silver */
    tbody tr.top3 td:first-child::before{ background: #fb923c; } /* Bronze */

    /* Subtle glow outline (keeps it premium) */
    tbody tr.top1{
      box-shadow: inset 0 0 0 1px rgba(251, 191, 36, .22), 0 0 0 1px rgba(251,191,36,.08);
    }
    tbody tr.top2{
      box-shadow: inset 0 0 0 1px rgba(226, 232, 240, .18), 0 0 0 1px rgba(226,232,240,.06);
    }
    tbody tr.top3{
      box-shadow: inset 0 0 0 1px rgba(251, 146, 60, .18), 0 0 0 1px rgba(251,146,60,.06);
    }

    .medal{
      width: 26px; height: 26px;
      border-radius: 10px;
      display: grid;
      place-items: center;
      border: 1px solid var(--border);
      background: rgba(2,6,23,.25);
    }
    .top1 .medal{ background: rgba(251,191,36,.22); border-color: rgba(251,191,36,.35); }
    .top2 .medal{ background: rgba(226,232,240,.16); border-color: rgba(226,232,240,.28); }
    .top3 .medal{ background: rgba(251,146,60,.16); border-color: rgba(251,146,60,.28); }

    .money{
      font-variant-numeric: tabular-nums;
      font-weight: 600;
    }
    .muted{ color: var(--muted); }

    @media (max-width: 980px){
      .card{ grid-column: span 6; }
      form{ grid-template-columns: 1fr 1fr 1fr auto; }
    }
    @media (max-width: 680px){
      header{ flex-direction: column; align-items: flex-start; }
      .card{ grid-column: span 12; }
      form{ grid-template-columns: 1fr; }
      .btn{ width: 100%; }
      .col-rank{ width: 72px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="title">
        <h1>Sales Leaderboard Dashboard</h1>
        <p class="subtitle">Track team performance, daily totals, and ranking in real time.</p>
      </div>
    </header>

    <section class="grid" aria-label="Key metrics">
      <div class="card">
        <div class="icon" aria-hidden="true">
          <span class="material-symbols-rounded">payments</span>
        </div>
        <div class="kpi">
          <div class="label">Total Amount (NPR)</div>
          <div class="value" id="totalAmount">—</div>
        </div>
      </div>

      <div class="card">
        <div class="icon" aria-hidden="true">
          <span class="material-symbols-rounded">receipt_long</span>
        </div>
        <div class="kpi">
          <div class="label">Total Sales</div>
          <div class="value" id="totalSales">—</div>
        </div>
      </div>

      <div class="card">
        <div class="icon" aria-hidden="true">
          <span class="material-symbols-rounded">today</span>
        </div>
        <div class="kpi">
          <div class="label">Today Amount (NPR)</div>
          <div class="value" id="todayAmount">—</div>
        </div>
      </div>

      <div class="card">
        <div class="icon" aria-hidden="true">
          <span class="material-symbols-rounded">query_stats</span>
        </div>
        <div class="kpi">
          <div class="label">Today Sales</div>
          <div class="value" id="todaySales">—</div>
        </div>
      </div>
    </section>

    <section class="panel" aria-label="Add sale">
      <div class="panel-header">
        <h2>
          <span class="material-symbols-rounded" aria-hidden="true">add_circle</span>
          Add a Sale
        </h2>
        <div class="right" id="statusText">
          <span class="material-symbols-rounded" aria-hidden="true" style="font-size:18px;">sync</span>
          Ready
        </div>
      </div>

      <form id="saleForm" autocomplete="off">
        <div class="field">
          <label for="agentName">Agent name</label>
          <input type="text" id="agentName" placeholder="e.g., Suman Shrestha" required />
        </div>

        <div class="field">
          <label for="amount">Amount (NPR)</label>
          <input type="number" id="amount" placeholder="e.g., 15000" min="0" step="1" required />
        </div>

        <div class="field">
          <label for="salesCount">Sales count</label>
          <input type="number" id="salesCount" value="1" min="1" step="1" required />
        </div>

        <button class="btn" type="submit" id="submitBtn">
          <span class="material-symbols-rounded" aria-hidden="true">send</span>
          Add Sale
        </button>
      </form>
    </section>

    <div style="height: 14px;"></div>

    <section class="panel" aria-label="Leaderboard">
      <div class="panel-header">
        <h2>
          <span class="material-symbols-rounded" aria-hidden="true">leaderboard</span>
          Leaderboard
        </h2>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th class="col-rank">Rank</th>
              <th>Agent</th>
              <th>Total Amount (NPR)</th>
              <th>Total Sales</th>
            </tr>
          </thead>
          <tbody id="leaderboard"></tbody>
        </table>
      </div>
    </section>
  </div>

  <script>
    const API_URL = "/api";

    const statusText = document.getElementById("statusText");
    const submitBtn = document.getElementById("submitBtn");

    const formatNPR = (value) => {
      const n = Number(value || 0);
      return new Intl.NumberFormat("en-NP", {
        style: "currency",
        currency: "NPR",
        maximumFractionDigits: 0
      }).format(n);
    };

    function setStatus(text, busy=false){
      statusText.textContent = text;
      submitBtn.disabled = busy;
    }

    function medalIcon(rank){
      if(rank === 1) return "trophy";
      if(rank === 2) return "workspace_premium";
      if(rank === 3) return "military_tech";
      return "tag";
    }

    async function loadLeaderboard() {
      const res = await fetch(API_URL + "/leaderboard");
      const data = await res.json();

      const tbody = document.getElementById("leaderboard");
      tbody.innerHTML = "";

      data.forEach(agent => {
        const tr = document.createElement("tr");
        if (agent.rank === 1) tr.classList.add("top1");
        if (agent.rank === 2) tr.classList.add("top2");
        if (agent.rank === 3) tr.classList.add("top3");

        tr.innerHTML = `
          <td class="col-rank">
            <span class="rank">
              <span class="medal" aria-hidden="true">
                <span class="material-symbols-rounded">${medalIcon(agent.rank)}</span>
              </span>
              #${agent.rank}
            </span>
          </td>
          <td>
            <span style="display:flex; align-items:center; gap:10px;">
              <span class="icon" style="width:32px; height:32px; border-radius:12px;" aria-hidden="true">
                <span class="material-symbols-rounded" style="font-size:18px;">person</span>
              </span>
              <span>
                <div style="font-weight:600; line-height:1.2;">${agent.agentName}</div>
                <div class="muted" style="font-size:12px; margin-top:2px;">Sales agent</div>
              </span>
            </span>
          </td>
          <td class="money">${formatNPR(agent.totalAmount)}</td>
          <td>${agent.totalSales}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function loadStats() {
      const res = await fetch(API_URL + "/stats");
      const s = await res.json();

      document.getElementById("totalAmount").innerText = formatNPR(s.totalAmount);
      document.getElementById("totalSales").innerText = Number(s.totalSales || 0);
      document.getElementById("todayAmount").innerText = formatNPR(s.todayAmount);
      document.getElementById("todaySales").innerText = Number(s.todaySales || 0);
    }

    document.getElementById("saleForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      setStatus("Submitting…", true);

      const agentName = document.getElementById("agentName").value.trim();
      const amount = Number(document.getElementById("amount").value);
      const salesCount = Number(document.getElementById("salesCount").value || 1);

      try{
        await fetch(API_URL + "/sales", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ agentName, amount, salesCount })
        });

        await Promise.all([loadLeaderboard(), loadStats()]);
        e.target.reset();
        document.getElementById("salesCount").value = 1;
        setStatus("Saved", false);
      } catch(err){
        console.error(err);
        setStatus("Error saving. Try again.", false);
      }
    });

    (async function init(){
      setStatus("Loading…", true);
      await Promise.all([loadLeaderboard(), loadStats()]);
      setStatus("Ready", false);
    })();

    setInterval(() => { loadLeaderboard(); loadStats(); }, 5000);
  </script>
</body>
</html>